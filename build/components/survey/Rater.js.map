{"version":3,"sources":["components/survey/Rater.js"],"names":["Star","Rater","props","state","lastRating","rating","isRating","nextProps","setState","e","getRatingFromDOMEvent","onRate","callback","originalEvent","index","Number","refs","isDisabled","total","limit","interactive","children","rest","Array","prototype","concat","filter","Boolean","nodes","join","split","map","_","i","starProps","isActive","willBeActive","key","ref","length","cloneElement","handleMouseEnter","bind","handleMouseLeave","handleMouseMove","handleClick","defaultProps","propTypes","number","bool","func","any","allStars","apply","currentTarget","childNodes","star","findStarDOMNode","target","indexOf","node","stars","container","parentNode"],"mappings":"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","file":"components/survey/Rater.js","sourcesContent":["import React, { Component, PropTypes } from 'react'\nimport Star from './star'\n\nexport { Star } from './star'\n\nexport default class Rater extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      lastRating: props.rating,\n      rating: props.rating,\n      isRating: false\n    }\n  }\n  componentWillReceiveProps(nextProps) {\n    this.setState({\n      rating: nextProps.rating\n    })\n  }\n  handleMouseEnter(e) {\n    let { rating } = getRatingFromDOMEvent(e, this.props)\n      , callback = this.props.onRate\n    if (rating > 0) {\n      this.setState({\n        rating: 0,\n        isRating: true\n      })\n      callback && callback({\n        originalEvent: e,\n        rating\n      })\n    }\n  }\n  handleMouseMove(e) {\n    let { rating } = getRatingFromDOMEvent(e, this.props)\n      , callback = this.props.onRate\n    if (rating > 0) {\n      this.setState({\n        rating: rating,\n        isRating: true\n      })\n      callback && callback({\n        originalEvent: e,\n        rating\n      })\n    }\n  }\n  handleMouseLeave(e) {\n    let callback = this.props.onRate\n      , state = this.state\n    this.setState({\n      rating: state.lastRating,\n      isRating: false\n    })\n    callback && callback({\n      originalEvent: e,\n      rating: state.lastRating\n    })\n  }\n  handleClick(e) {\n    let { index, rating } = getRatingFromDOMEvent(e, this.props)\n      , lastRating = Number(this.state.lastRating)\n      , callback = this.props.onRate\n    if (rating < 0 || this.refs[`star-${index}`].props.isDisabled) {\n      return\n    }\n    this.setState({\n      rating,\n      lastRating: rating\n    })\n    callback && callback({\n      originalEvent: e,\n      rating,\n      lastRating\n    })\n  }\n  render() {\n    let { total, limit, rating, interactive, children, ...rest } = this.props\n    total = Number(total)\n    limit = Number(limit)\n    rating = Number(this.state.rating)\n    children = Array.prototype.concat(children).filter(Boolean)\n    limit = (this.props.limit === void 0)? total: limit\n    delete rest.onRate\n    let nodes = Array(total).join(',').split(',').map((_, i) => {\n      let starProps = {\n        isActive: (!this.state.isRating && i < rating) ? true: false,\n        willBeActive: (this.state.isRating && i < rating)? true: false,\n        isDisabled: (i < limit) ? false: true,\n        key: `star-${i}`,\n        ref: `star-${i}`\n      }\n      if (children.length) {\n        return React.cloneElement(children[i % children.length], starProps)\n      } else {\n        return (<Star {...starProps} />)\n      }\n    })\n    if (interactive) {\n      return (\n        <div className=\"react-rater\"\n             onMouseEnter={this.handleMouseEnter.bind(this)}\n             onMouseLeave={this.handleMouseLeave.bind(this)}\n             onMouseMove={this.handleMouseMove.bind(this)}\n             onClick={this.handleClick.bind(this)}\n             {...rest}>{nodes}</div>\n      )\n    } else {\n      return (\n        <div className=\"react-rater is-disabled\" {...rest}>{nodes}</div>\n      )\n    }\n  }\n}\n\nRater.defaultProps = {\n  total: 5,\n  rating: 0,\n  interactive: true\n}\n\nRater.propTypes = {\n  total: PropTypes.number,\n  rating: PropTypes.number,\n  limit: PropTypes.number,\n  interactive: PropTypes.bool,\n  onRate: PropTypes.func,\n  children: PropTypes.any\n}\n\nfunction getRatingFromDOMEvent(e, props) {\n  let allStars = Array.apply(null, e.currentTarget.childNodes)\n    , star = findStarDOMNode(e.target, allStars, e.currentTarget)\n    , index = allStars.indexOf(star)\n    , rating = index + 1\n    , limit = Number(props.limit)\n  if (index < 0) {\n    return {\n      index,\n      rating: -1\n    }\n  }\n  limit = (props.limit === void 0)? props.total: limit\n  rating = rating < limit? rating: limit\n  return {\n    index,\n    rating: Number(rating)\n  }\n}\n\nfunction findStarDOMNode(node, stars, container) {\n  while(node !== container && stars.indexOf(node) === -1) {\n    node = node.parentNode\n  }\n  return node\n}\n"],"sourceRoot":"/source/"}